<html>
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<script src="http://code.jquery.com/jquery-2.0.0.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="http://code.highcharts.com/stock/highstock.js"></script>
<script src="http://code.highcharts.com/stock/modules/exporting.js"></script>
 <body>
    <div class="row">
        <form id="seriesForm" action="javascript:void(0)">
            <div class="col-md-8">
                <label class="checkbox-inline">
                    <input type="checkbox" id="price" value="price"> price
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" id="sma" value="sma"> sma
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" id="isma" value="isma"> isma
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" id="wma" value="wma"> wma
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" id="ema" value="ema"> ema
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" id="iema" value="iema"> iema
                </label>
                 <label class="checkbox-inline">
                    <input type="checkbox" id="tma" value="tma"> tma
                </label>
            </div>
            <button type="submit" class="btn btn-default">Go!</button>
        </form>
    </div>
      <div class="row">
      <div class="col-md-12"> <div id="container" style="height: 900px; min-width: 310px"></div></div>
    </div>

     <script>
     var queryString="type=price";
     jQuery(function () {

        jQuery("#seriesForm").submit(function(event) {

            /* stop form from submitting normally */
            event.preventDefault();

            /* get some values from elements on the page: */
            var form = jQuery( this );


            queryString="";
            form.find('input, textarea, select').each(function(el) {
               console.log( this.value+  ": " +this.checked);
                if(this.checked)
                    queryString+='type='+this.value+'&';
            });
            queryString+='_end';
            console.log( "queryString: "+ queryString);

            /* remote call */
            jQuery.getJSON('http://local.piggy-trade.com/api/series?'+queryString, function (data) {
            var dates=data.dates;
            var resultSeries= new Array();

            for(var entryN in  data.results) {
              console.log("result entry: "+entryN);
                var entryD=data.results[entryN];
                var entryT= integrate(entryD,dates);
                var entrySerie= createSeries(entryN,entryT.reverse());
                resultSeries.push(entrySerie);
            }

             jQuery('#container').highcharts('StockChart', {
                rangeSelector : {
                    selected : 5,
                    inputEnabled: jQuery('#container').width() > 480
                },

                title : {
                    text : ' Stock Prices'
                },

                series : resultSeries
             });

        });

     });




        });


    function integrate(values, dates) {
        var result=new Array();
        for (i = 0; i < values.length; i++) {
            var entry=new Array();
            entry[0]=dates[i];
            entry[1]=values[i];
            result.push(entry);
        }
        return result;
    }
    function createSeries(name,data) {
        var seriesObject={
                name : name,
                data : data,
                tooltip: {
                    valueDecimals: 2
                }
            }
        return seriesObject;
    }
     </script>
</body>

</html>
